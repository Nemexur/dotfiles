#!/usr/bin/env bash
#
# bootstrap installs things.
source $HOME/.dotfiles/scripts/prompt

cd "$DOTFILES"
DOTFILES_ROOT=$(pwd -P)

set -e

echo ""

runBootstrap() {
  local extra=""
  if ! [[ -z ${@: 2} ]]; then
    extra="--tags ${@: 2}"
  fi
  ansible-galaxy install --role-file $HOME/.dotfiles/requirements.yml -vvv
  ansible-playbook $HOME/.dotfiles/main.yml $extra
}

displayUsageAndExit() {
  echo "dot -- dotfiles management."
  echo ""
  echo "Usage: dot [options] [ansible-playbook options]"
  echo ""
  echo "Options:"
  echo "  -h, --help    Show this help message and exit."
  echo "  -t, --tags    Dotfiles tags for partial update."
  echo "                Available tags: homebrew, gitconfig,"
  echo "                                zsh, tmux, emacs, pass,"
  echo "                                creates, symlinks,"
  echo "                                installs, macos, extra."
  echo "Ansible-playbook options:"
  echo "  Extra options for ansible-playbook command."
  echo "  Works only with --tags option."
  exit 0
}

while test $# -gt 0; do
    case "$1" in
        "-h"|"--help")
            displayUsageAndExit
            ;;
        "-t"|"--tags")
            runBootstrap $@
            exit
            ;;
        *)
            echo "Invalid option: $1"
            echo ""
            displayUsageAndExit
            ;;
    esac
    shift
done

runBootstrap ""
