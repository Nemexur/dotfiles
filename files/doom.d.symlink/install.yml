---
- name: Check doom emacs directories
  ansible.builtin.stat: "path={{ item }}"
  loop:
    - "{{ home_dir }}/.doom.d"
    - "{{ home_dir }}/.emacs.d/bin"
  register: _install_doom_emacs_dirs

- name: Update doom emacs configuration
  when: "not (_install_doom_emacs_dirs.results | map(attribute='stat') | map(attribute='exists') | min)"
  block:
    - name: Run doom emacs sync
      ansible.builtin.command: "{{ home_dir }}/.emacs.d/bin/doom sync -up"
      changed_when: true

    - name: Run doom emacs clean
      ansible.builtin.command: "{{ home_dir }}/.emacs.d/bin/doom clean"
      changed_when: true

    - name: Run doom emacs env
      ansible.builtin.command: "{{ home_dir }}/.emacs.d/bin/doom env"
      changed_when: true

    - name: Run doom emacs doctor
      ansible.builtin.command: "{{ home_dir }}/.emacs.d/bin/doom doctor"
      ignore_errors: true
      changed_when: true
